{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[typeof Symbol === \"function\" ? Symbol.iterator : \"@@iterator\"] || o[\"@@iterator\"]; if (it) return (it = it.call(o)).next.bind(it); if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\nimport { PermissionStatus } from \"./Permissions.types\";\nfunction _getUserMedia(constraints) {\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    return navigator.mediaDevices.getUserMedia(constraints);\n  }\n  var getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || function () {\n    var error = new Error('Permission unimplemented');\n    error.code = 0;\n    error.name = 'NotAllowedError';\n    throw error;\n  };\n  return new Promise(function (resolve, reject) {\n    getUserMedia.call(navigator, constraints, resolve, reject);\n  });\n}\nfunction askForMediaPermissionAsync(options) {\n  var message;\n  return _regeneratorRuntime.async(function askForMediaPermissionAsync$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 3;\n          return _regeneratorRuntime.awrap(_getUserMedia(options));\n        case 3:\n          return _context.abrupt(\"return\", {\n            status: PermissionStatus.GRANTED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: true\n          });\n        case 6:\n          _context.prev = 6;\n          _context.t0 = _context[\"catch\"](0);\n          message = _context.t0.message;\n          if (!(message === 'Permission dismissed')) {\n            _context.next = 13;\n            break;\n          }\n          return _context.abrupt(\"return\", {\n            status: PermissionStatus.UNDETERMINED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false\n          });\n        case 13:\n          return _context.abrupt(\"return\", {\n            status: PermissionStatus.DENIED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false\n          });\n        case 14:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, [[0, 6]], Promise);\n}\nfunction askForMicrophonePermissionAsync() {\n  return _regeneratorRuntime.async(function askForMicrophonePermissionAsync$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return _regeneratorRuntime.awrap(askForMediaPermissionAsync({\n            audio: true\n          }));\n        case 2:\n          return _context2.abrupt(\"return\", _context2.sent);\n        case 3:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\nfunction askForCameraPermissionAsync() {\n  return _regeneratorRuntime.async(function askForCameraPermissionAsync$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.next = 2;\n          return _regeneratorRuntime.awrap(askForMediaPermissionAsync({\n            video: true\n          }));\n        case 2:\n          return _context3.abrupt(\"return\", _context3.sent);\n        case 3:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\nfunction askForLocationPermissionAsync() {\n  return _regeneratorRuntime.async(function askForLocationPermissionAsync$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          return _context4.abrupt(\"return\", new Promise(function (resolve) {\n            navigator.geolocation.getCurrentPosition(function () {\n              return resolve({\n                status: PermissionStatus.GRANTED,\n                expires: 'never',\n                canAskAgain: true,\n                granted: true\n              });\n            }, function (_ref2) {\n              var code = _ref2.code;\n              if (code === 1) {\n                resolve({\n                  status: PermissionStatus.DENIED,\n                  expires: 'never',\n                  canAskAgain: true,\n                  granted: false\n                });\n              } else {\n                resolve({\n                  status: PermissionStatus.UNDETERMINED,\n                  expires: 'never',\n                  canAskAgain: true,\n                  granted: false\n                });\n              }\n            });\n          }));\n        case 1:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\nfunction getPermissionWithQueryAsync(name) {\n  var _await$navigator$perm, state;\n  return _regeneratorRuntime.async(function getPermissionWithQueryAsync$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          if (!(!navigator || !navigator.permissions || !navigator.permissions.query)) {\n            _context5.next = 2;\n            break;\n          }\n          return _context5.abrupt(\"return\", null);\n        case 2:\n          _context5.next = 4;\n          return _regeneratorRuntime.awrap(navigator.permissions.query({\n            name: name\n          }));\n        case 4:\n          _await$navigator$perm = _context5.sent;\n          state = _await$navigator$perm.state;\n          if (!(state === 'prompt')) {\n            _context5.next = 10;\n            break;\n          }\n          return _context5.abrupt(\"return\", PermissionStatus.UNDETERMINED);\n        case 10:\n          if (!(state === 'granted')) {\n            _context5.next = 14;\n            break;\n          }\n          return _context5.abrupt(\"return\", PermissionStatus.GRANTED);\n        case 14:\n          if (!(state === 'denied')) {\n            _context5.next = 16;\n            break;\n          }\n          return _context5.abrupt(\"return\", PermissionStatus.DENIED);\n        case 16:\n          return _context5.abrupt(\"return\", null);\n        case 17:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\nfunction enumerateDevices() {\n  return _regeneratorRuntime.async(function enumerateDevices$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          if (!(navigator && navigator.mediaDevices && navigator.mediaDevices.enumerateDevices)) {\n            _context6.next = 4;\n            break;\n          }\n          _context6.next = 3;\n          return _regeneratorRuntime.awrap(navigator.mediaDevices.enumerateDevices());\n        case 3:\n          return _context6.abrupt(\"return\", _context6.sent);\n        case 4:\n          if (!(window.MediaStreamTrack && typeof window.MediaStreamTrack.getSources === 'function')) {\n            _context6.next = 8;\n            break;\n          }\n          _context6.next = 7;\n          return _regeneratorRuntime.awrap(MediaStreamTrack.getSources());\n        case 7:\n          return _context6.abrupt(\"return\", _context6.sent);\n        case 8:\n          return _context6.abrupt(\"return\", null);\n        case 9:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\nfunction getMediaMaybeGrantedAsync(targetKind) {\n  var devices, result;\n  return _regeneratorRuntime.async(function getMediaMaybeGrantedAsync$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          _context7.next = 2;\n          return _regeneratorRuntime.awrap(enumerateDevices());\n        case 2:\n          devices = _context7.sent;\n          if (devices) {\n            _context7.next = 5;\n            break;\n          }\n          return _context7.abrupt(\"return\", false);\n        case 5:\n          _context7.next = 7;\n          return _regeneratorRuntime.awrap(devices.filter(function (_ref3) {\n            var kind = _ref3.kind;\n            return kind === targetKind;\n          }).some(function (_ref4) {\n            var label = _ref4.label;\n            return label !== '';\n          }));\n        case 7:\n          result = _context7.sent;\n          return _context7.abrupt(\"return\", result);\n        case 9:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\nfunction getPermissionAsync(permission, shouldAsk) {\n  var status, _window, _window$Notification, Notification, _status, maybeStatus, _maybeStatus, maybeGranted, _maybeStatus2, _maybeGranted;\n  return _regeneratorRuntime.async(function getPermissionAsync$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          _context8.t0 = permission;\n          _context8.next = _context8.t0 === 'userFacingNotifications' ? 3 : _context8.t0 === 'notifications' ? 3 : _context8.t0 === 'location' ? 20 : _context8.t0 === 'audioRecording' ? 36 : _context8.t0 === 'camera' ? 59 : 82;\n          break;\n        case 3:\n          if (shouldAsk) {\n            _context8.next = 9;\n            break;\n          }\n          _context8.next = 6;\n          return _regeneratorRuntime.awrap(getPermissionWithQueryAsync('notifications'));\n        case 6:\n          status = _context8.sent;\n          if (!status) {\n            _context8.next = 9;\n            break;\n          }\n          return _context8.abrupt(\"return\", {\n            status: status,\n            expires: 'never',\n            granted: status === PermissionStatus.GRANTED,\n            canAskAgain: true\n          });\n        case 9:\n          _window = window, _window$Notification = _window.Notification, Notification = _window$Notification === void 0 ? {} : _window$Notification;\n          if (!Notification.requestPermission) {\n            _context8.next = 19;\n            break;\n          }\n          _status = Notification.permission;\n          if (!shouldAsk) {\n            _context8.next = 16;\n            break;\n          }\n          _context8.next = 15;\n          return _regeneratorRuntime.awrap(Notification.requestPermission());\n        case 15:\n          _status = _context8.sent;\n        case 16:\n          if (!(!_status || _status === 'default')) {\n            _context8.next = 18;\n            break;\n          }\n          return _context8.abrupt(\"return\", {\n            status: PermissionStatus.UNDETERMINED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false\n          });\n        case 18:\n          return _context8.abrupt(\"return\", {\n            status: _status,\n            expires: 'never',\n            canAskAgain: true,\n            granted: _status === PermissionStatus.GRANTED\n          });\n        case 19:\n          return _context8.abrupt(\"break\", 83);\n        case 20:\n          _context8.next = 22;\n          return _regeneratorRuntime.awrap(getPermissionWithQueryAsync('geolocation'));\n        case 22:\n          maybeStatus = _context8.sent;\n          if (!maybeStatus) {\n            _context8.next = 31;\n            break;\n          }\n          if (!(maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk)) {\n            _context8.next = 28;\n            break;\n          }\n          _context8.next = 27;\n          return _regeneratorRuntime.awrap(askForLocationPermissionAsync());\n        case 27:\n          return _context8.abrupt(\"return\", _context8.sent);\n        case 28:\n          return _context8.abrupt(\"return\", {\n            status: maybeStatus,\n            expires: 'never',\n            canAskAgain: true,\n            granted: maybeStatus === PermissionStatus.GRANTED\n          });\n        case 31:\n          if (!shouldAsk) {\n            _context8.next = 35;\n            break;\n          }\n          _context8.next = 34;\n          return _regeneratorRuntime.awrap(askForLocationPermissionAsync());\n        case 34:\n          return _context8.abrupt(\"return\", _context8.sent);\n        case 35:\n          return _context8.abrupt(\"break\", 83);\n        case 36:\n          _context8.next = 38;\n          return _regeneratorRuntime.awrap(getPermissionWithQueryAsync('microphone'));\n        case 38:\n          _maybeStatus = _context8.sent;\n          if (!_maybeStatus) {\n            _context8.next = 47;\n            break;\n          }\n          if (!(_maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk)) {\n            _context8.next = 44;\n            break;\n          }\n          _context8.next = 43;\n          return _regeneratorRuntime.awrap(askForMicrophonePermissionAsync());\n        case 43:\n          return _context8.abrupt(\"return\", _context8.sent);\n        case 44:\n          return _context8.abrupt(\"return\", {\n            status: _maybeStatus,\n            expires: 'never',\n            canAskAgain: true,\n            granted: _maybeStatus === PermissionStatus.GRANTED\n          });\n        case 47:\n          if (!shouldAsk) {\n            _context8.next = 53;\n            break;\n          }\n          _context8.next = 50;\n          return _regeneratorRuntime.awrap(askForMicrophonePermissionAsync());\n        case 50:\n          return _context8.abrupt(\"return\", _context8.sent);\n        case 53:\n          _context8.next = 55;\n          return _regeneratorRuntime.awrap(getMediaMaybeGrantedAsync('audioinput'));\n        case 55:\n          maybeGranted = _context8.sent;\n          if (!maybeGranted) {\n            _context8.next = 58;\n            break;\n          }\n          return _context8.abrupt(\"return\", {\n            status: PermissionStatus.GRANTED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: true\n          });\n        case 58:\n          return _context8.abrupt(\"break\", 83);\n        case 59:\n          _context8.next = 61;\n          return _regeneratorRuntime.awrap(getPermissionWithQueryAsync('camera'));\n        case 61:\n          _maybeStatus2 = _context8.sent;\n          if (!_maybeStatus2) {\n            _context8.next = 70;\n            break;\n          }\n          if (!(_maybeStatus2 === PermissionStatus.UNDETERMINED && shouldAsk)) {\n            _context8.next = 67;\n            break;\n          }\n          _context8.next = 66;\n          return _regeneratorRuntime.awrap(askForCameraPermissionAsync());\n        case 66:\n          return _context8.abrupt(\"return\", _context8.sent);\n        case 67:\n          return _context8.abrupt(\"return\", {\n            status: _maybeStatus2,\n            expires: 'never',\n            canAskAgain: true,\n            granted: _maybeStatus2 === PermissionStatus.GRANTED\n          });\n        case 70:\n          if (!shouldAsk) {\n            _context8.next = 76;\n            break;\n          }\n          _context8.next = 73;\n          return _regeneratorRuntime.awrap(askForCameraPermissionAsync());\n        case 73:\n          return _context8.abrupt(\"return\", _context8.sent);\n        case 76:\n          _context8.next = 78;\n          return _regeneratorRuntime.awrap(getMediaMaybeGrantedAsync('videoinput'));\n        case 78:\n          _maybeGranted = _context8.sent;\n          if (!_maybeGranted) {\n            _context8.next = 81;\n            break;\n          }\n          return _context8.abrupt(\"return\", {\n            status: PermissionStatus.GRANTED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: true\n          });\n        case 81:\n          return _context8.abrupt(\"break\", 83);\n        case 82:\n          return _context8.abrupt(\"break\", 83);\n        case 83:\n          return _context8.abrupt(\"return\", {\n            status: PermissionStatus.UNDETERMINED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false\n          });\n        case 84:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\nexport default {\n  get name() {\n    return 'ExpoPermissions';\n  },\n  getAsync: function getAsync(permissionTypes) {\n    var results, _iterator, _step, permissionType;\n    return _regeneratorRuntime.async(function getAsync$(_context9) {\n      while (1) {\n        switch (_context9.prev = _context9.next) {\n          case 0:\n            results = {};\n            _iterator = _createForOfIteratorHelperLoose(new Set(permissionTypes));\n          case 2:\n            if ((_step = _iterator()).done) {\n              _context9.next = 9;\n              break;\n            }\n            permissionType = _step.value;\n            _context9.next = 6;\n            return _regeneratorRuntime.awrap(getPermissionAsync(permissionType, false));\n          case 6:\n            results[permissionType] = _context9.sent;\n          case 7:\n            _context9.next = 2;\n            break;\n          case 9:\n            return _context9.abrupt(\"return\", results);\n          case 10:\n          case \"end\":\n            return _context9.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  },\n  askAsync: function askAsync(permissionTypes) {\n    var results, _iterator2, _step2, permissionType;\n    return _regeneratorRuntime.async(function askAsync$(_context10) {\n      while (1) {\n        switch (_context10.prev = _context10.next) {\n          case 0:\n            results = {};\n            _iterator2 = _createForOfIteratorHelperLoose(new Set(permissionTypes));\n          case 2:\n            if ((_step2 = _iterator2()).done) {\n              _context10.next = 9;\n              break;\n            }\n            permissionType = _step2.value;\n            _context10.next = 6;\n            return _regeneratorRuntime.awrap(getPermissionAsync(permissionType, true));\n          case 6:\n            results[permissionType] = _context10.sent;\n          case 7:\n            _context10.next = 2;\n            break;\n          case 9:\n            return _context10.abrupt(\"return\", results);\n          case 10:\n          case \"end\":\n            return _context10.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n};","map":{"version":3,"mappings":"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","names":["PermissionStatus","_getUserMedia","constraints","navigator","mediaDevices","getUserMedia","webkitGetUserMedia","mozGetUserMedia","error","Error","code","name","Promise","resolve","reject","call","askForMediaPermissionAsync","options","status","GRANTED","expires","canAskAgain","granted","message","UNDETERMINED","DENIED","askForMicrophonePermissionAsync","audio","askForCameraPermissionAsync","video","askForLocationPermissionAsync","geolocation","getCurrentPosition","getPermissionWithQueryAsync","permissions","query","state","enumerateDevices","window","MediaStreamTrack","getSources","getMediaMaybeGrantedAsync","targetKind","devices","filter","kind","some","label","result","getPermissionAsync","permission","shouldAsk","Notification","requestPermission","maybeStatus","maybeGranted","getAsync","permissionTypes","results","Set","permissionType","askAsync"],"sourceRoot":"","sources":["../src/ExpoPermissions.web.ts"],"sourcesContent":["import {\n  PermissionMap,\n  PermissionType,\n  PermissionStatus,\n  PermissionInfo,\n} from './Permissions.types';\n\n/*\n * TODO: Bacon: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Permissions\n * Add messages to manifest like we do with iOS info.plist\n */\n\n// https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Using_the_new_API_in_older_browsers\n// Older browsers might not implement mediaDevices at all, so we set an empty object first\nfunction _getUserMedia(constraints: MediaStreamConstraints): Promise<MediaStream> {\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    return navigator.mediaDevices.getUserMedia(constraints);\n  }\n\n  // Some browsers partially implement mediaDevices. We can't just assign an object\n  // with getUserMedia as it would overwrite existing properties.\n  // Here, we will just add the getUserMedia property if it's missing.\n\n  // First get ahold of the legacy getUserMedia, if present\n  const getUserMedia =\n    navigator.getUserMedia ||\n    (navigator as any).webkitGetUserMedia ||\n    (navigator as any).mozGetUserMedia ||\n    function() {\n      const error: any = new Error('Permission unimplemented');\n      error.code = 0;\n      error.name = 'NotAllowedError';\n      throw error;\n    };\n\n  return new Promise((resolve, reject) => {\n    getUserMedia.call(navigator, constraints, resolve, reject);\n  });\n}\n\nasync function askForMediaPermissionAsync(\n  options: MediaStreamConstraints\n): Promise<PermissionInfo> {\n  try {\n    await _getUserMedia(options);\n    return {\n      status: PermissionStatus.GRANTED,\n      expires: 'never',\n      canAskAgain: true,\n      granted: true,\n    };\n  } catch ({ message }) {\n    // name: NotAllowedError\n    // code: 0\n    if (message === 'Permission dismissed') {\n      // message: Permission dismissed\n      return {\n        status: PermissionStatus.UNDETERMINED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: false,\n      };\n    } else {\n      // TODO: Bacon: [OSX] The system could deny access to chrome.\n      // TODO: Bacon: add: { status: 'unimplemented' }\n      // message: Permission denied\n      return {\n        status: PermissionStatus.DENIED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: false,\n      };\n    }\n  }\n}\n\nasync function askForMicrophonePermissionAsync(): Promise<PermissionInfo> {\n  return await askForMediaPermissionAsync({ audio: true });\n}\n\nasync function askForCameraPermissionAsync(): Promise<PermissionInfo> {\n  return await askForMediaPermissionAsync({ video: true });\n}\n\nasync function askForLocationPermissionAsync(): Promise<PermissionInfo> {\n  return new Promise(resolve => {\n    navigator.geolocation.getCurrentPosition(\n      () =>\n        resolve({\n          status: PermissionStatus.GRANTED,\n          expires: 'never',\n          canAskAgain: true,\n          granted: true,\n        }),\n      ({ code }: PositionError) => {\n        // https://developer.mozilla.org/en-US/docs/Web/API/PositionError/code\n        if (code === 1) {\n          resolve({\n            status: PermissionStatus.DENIED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false,\n          });\n        } else {\n          resolve({\n            status: PermissionStatus.UNDETERMINED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false,\n          });\n        }\n      }\n    );\n  });\n}\n\nasync function getPermissionWithQueryAsync(name: PermissionName): Promise<PermissionStatus | null> {\n  if (!navigator || !navigator.permissions || !navigator.permissions.query) return null;\n\n  const { state } = await navigator.permissions.query({ name });\n  if (state === 'prompt') {\n    return PermissionStatus.UNDETERMINED;\n  } else if (state === 'granted') {\n    return PermissionStatus.GRANTED;\n  } else if (state === 'denied') {\n    return PermissionStatus.DENIED;\n  }\n  return null;\n}\n\nasync function enumerateDevices(): Promise<MediaDeviceInfo[] | null> {\n  if (navigator && navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {\n    return await navigator.mediaDevices.enumerateDevices();\n  }\n\n  // @ts-ignore: This is deprecated but we should still attempt to use it.\n  if (window.MediaStreamTrack && typeof window.MediaStreamTrack.getSources === 'function') {\n    // @ts-ignore\n    return await MediaStreamTrack.getSources();\n  }\n  return null;\n}\n\nasync function getMediaMaybeGrantedAsync(targetKind: MediaDeviceKind): Promise<boolean> {\n  const devices = await enumerateDevices();\n  if (!devices) {\n    return false;\n  }\n  const result = await devices\n    .filter(({ kind }) => kind === targetKind)\n    .some(({ label }) => label !== '');\n  // Granted or denied or undetermined or no devices\n  return result;\n}\n\nasync function getPermissionAsync(\n  permission: PermissionType,\n  shouldAsk: boolean\n): Promise<PermissionInfo> {\n  switch (permission) {\n    case 'userFacingNotifications':\n    case 'notifications':\n      {\n        if (!shouldAsk) {\n          const status = await getPermissionWithQueryAsync('notifications');\n          if (status) {\n            return {\n              status,\n              expires: 'never',\n              granted: status === PermissionStatus.GRANTED,\n              canAskAgain: true,\n            };\n          }\n        }\n\n        const { Notification = {} } = window as any;\n        if (Notification.requestPermission) {\n          let status = Notification.permission;\n          if (shouldAsk) {\n            status = await Notification.requestPermission();\n          }\n          if (!status || status === 'default') {\n            return {\n              status: PermissionStatus.UNDETERMINED,\n              expires: 'never',\n              canAskAgain: true,\n              granted: false,\n            };\n          }\n          return {\n            status,\n            expires: 'never',\n            canAskAgain: true,\n            granted: status === PermissionStatus.GRANTED,\n          };\n        }\n      }\n      break;\n    case 'location':\n      {\n        const maybeStatus = await getPermissionWithQueryAsync('geolocation');\n        if (maybeStatus) {\n          if (maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk) {\n            return await askForLocationPermissionAsync();\n          }\n          return {\n            status: maybeStatus,\n            expires: 'never',\n            canAskAgain: true,\n            granted: maybeStatus === PermissionStatus.GRANTED,\n          };\n        } else if (shouldAsk) {\n          // TODO: Bacon: should this function as ask async when not in chrome?\n          return await askForLocationPermissionAsync();\n        }\n      }\n      break;\n    case 'audioRecording':\n      {\n        const maybeStatus = await getPermissionWithQueryAsync('microphone');\n        if (maybeStatus) {\n          if (maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk) {\n            return await askForMicrophonePermissionAsync();\n          }\n          return {\n            status: maybeStatus,\n            expires: 'never',\n            canAskAgain: true,\n            granted: maybeStatus === PermissionStatus.GRANTED,\n          };\n        } else if (shouldAsk) {\n          return await askForMicrophonePermissionAsync();\n        } else {\n          const maybeGranted = await getMediaMaybeGrantedAsync('audioinput');\n          if (maybeGranted) {\n            return {\n              status: PermissionStatus.GRANTED,\n              expires: 'never',\n              canAskAgain: true,\n              granted: true,\n            };\n          }\n          // TODO: Bacon: Get denied or undetermined...\n        }\n      }\n      break;\n    case 'camera':\n      {\n        const maybeStatus = await getPermissionWithQueryAsync('camera');\n        if (maybeStatus) {\n          if (maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk) {\n            return await askForCameraPermissionAsync();\n          }\n          return {\n            status: maybeStatus,\n            expires: 'never',\n            canAskAgain: true,\n            granted: maybeStatus === PermissionStatus.GRANTED,\n          };\n        } else if (shouldAsk) {\n          return await askForCameraPermissionAsync();\n        } else {\n          const maybeGranted = await getMediaMaybeGrantedAsync('videoinput');\n          if (maybeGranted) {\n            return {\n              status: PermissionStatus.GRANTED,\n              expires: 'never',\n              canAskAgain: true,\n              granted: true,\n            };\n          }\n          // TODO: Bacon: Get denied or undetermined...\n        }\n      }\n      break;\n    default:\n      break;\n  }\n  return {\n    status: PermissionStatus.UNDETERMINED,\n    expires: 'never',\n    canAskAgain: true,\n    granted: false,\n  };\n}\n\nexport default {\n  get name(): string {\n    return 'ExpoPermissions';\n  },\n\n  async getAsync(permissionTypes: PermissionType[]): Promise<PermissionMap> {\n    const results = {};\n    for (const permissionType of new Set(permissionTypes)) {\n      results[permissionType] = await getPermissionAsync(permissionType, /* shouldAsk */ false);\n    }\n    return results;\n  },\n\n  async askAsync(permissionTypes: PermissionType[]): Promise<PermissionMap> {\n    const results = {};\n    for (const permissionType of new Set(permissionTypes)) {\n      results[permissionType] = await getPermissionAsync(permissionType, /* shouldAsk */ true);\n    }\n    return results;\n  },\n};\n"]},"metadata":{},"sourceType":"module"}