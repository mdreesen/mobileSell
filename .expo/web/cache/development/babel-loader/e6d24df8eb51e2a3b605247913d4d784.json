{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nvar _MediaTypeInput;\nimport * as Permissions from 'expo-permissions';\nimport { PermissionStatus } from 'unimodules-permissions-interface';\nimport uuidv4 from 'uuid/v4';\nimport { MediaTypeOptions } from \"./ImagePicker.types\";\nvar MediaTypeInput = (_MediaTypeInput = {}, _defineProperty(_MediaTypeInput, MediaTypeOptions.All, 'video/mp4,video/quicktime,video/x-m4v,video/*,image/*'), _defineProperty(_MediaTypeInput, MediaTypeOptions.Images, 'image/*'), _defineProperty(_MediaTypeInput, MediaTypeOptions.Videos, 'video/mp4,video/quicktime,video/x-m4v,video/*'), _MediaTypeInput);\nexport default {\n  get name() {\n    return 'ExponentImagePicker';\n  },\n  launchImageLibraryAsync: function launchImageLibraryAsync(_ref) {\n    var _ref$mediaTypes, mediaTypes, _ref$allowsMultipleSe, allowsMultipleSelection;\n    return _regeneratorRuntime.async(function launchImageLibraryAsync$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _ref$mediaTypes = _ref.mediaTypes, mediaTypes = _ref$mediaTypes === void 0 ? MediaTypeOptions.All : _ref$mediaTypes, _ref$allowsMultipleSe = _ref.allowsMultipleSelection, allowsMultipleSelection = _ref$allowsMultipleSe === void 0 ? false : _ref$allowsMultipleSe;\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(openFileBrowserAsync({\n              mediaTypes: mediaTypes,\n              allowsMultipleSelection: allowsMultipleSelection\n            }));\n          case 3:\n            return _context.abrupt(\"return\", _context.sent);\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  },\n  launchCameraAsync: function launchCameraAsync(_ref2) {\n    var _ref2$mediaTypes, mediaTypes, _ref2$allowsMultipleS, allowsMultipleSelection;\n    return _regeneratorRuntime.async(function launchCameraAsync$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _ref2$mediaTypes = _ref2.mediaTypes, mediaTypes = _ref2$mediaTypes === void 0 ? MediaTypeOptions.All : _ref2$mediaTypes, _ref2$allowsMultipleS = _ref2.allowsMultipleSelection, allowsMultipleSelection = _ref2$allowsMultipleS === void 0 ? false : _ref2$allowsMultipleS;\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(openFileBrowserAsync({\n              mediaTypes: mediaTypes,\n              allowsMultipleSelection: allowsMultipleSelection,\n              capture: true\n            }));\n          case 3:\n            return _context2.abrupt(\"return\", _context2.sent);\n          case 4:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  },\n  getCameraPermissionAsync: function getCameraPermissionAsync() {\n    return _regeneratorRuntime.async(function getCameraPermissionAsync$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            return _context3.abrupt(\"return\", Permissions.getAsync(Permissions.CAMERA));\n          case 1:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  },\n  requestCameraPermissionsAsync: function requestCameraPermissionsAsync() {\n    return _regeneratorRuntime.async(function requestCameraPermissionsAsync$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            return _context4.abrupt(\"return\", Permissions.askAsync(Permissions.CAMERA));\n          case 1:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  },\n  getCameraRollPermissionsAsync: function getCameraRollPermissionsAsync() {\n    return _regeneratorRuntime.async(function getCameraRollPermissionsAsync$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            return _context5.abrupt(\"return\", permissionGrantedResponse());\n          case 1:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  },\n  requestCameraRollPermissionsAsync: function requestCameraRollPermissionsAsync() {\n    return _regeneratorRuntime.async(function requestCameraRollPermissionsAsync$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            return _context6.abrupt(\"return\", permissionGrantedResponse());\n          case 1:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n};\nfunction permissionGrantedResponse() {\n  return {\n    status: PermissionStatus.GRANTED,\n    expires: 'never',\n    granted: true,\n    canAskAgain: true\n  };\n}\nfunction openFileBrowserAsync(_ref3) {\n  var mediaTypes = _ref3.mediaTypes,\n    _ref3$capture = _ref3.capture,\n    capture = _ref3$capture === void 0 ? false : _ref3$capture,\n    _ref3$allowsMultipleS = _ref3.allowsMultipleSelection,\n    allowsMultipleSelection = _ref3$allowsMultipleS === void 0 ? false : _ref3$allowsMultipleS;\n  var mediaTypeFormat = MediaTypeInput[mediaTypes];\n  var input = document.createElement('input');\n  input.style.display = 'none';\n  input.setAttribute('type', 'file');\n  input.setAttribute('accept', mediaTypeFormat);\n  input.setAttribute('id', uuidv4());\n  if (allowsMultipleSelection) {\n    input.setAttribute('multiple', 'multiple');\n  }\n  if (capture) {\n    input.setAttribute('capture', 'camera');\n  }\n  document.body.appendChild(input);\n  return new Promise(function (resolve, reject) {\n    input.addEventListener('change', function () {\n      if (input.files) {\n        var targetFile = input.files[0];\n        var reader = new FileReader();\n        reader.onerror = function () {\n          reject(new Error(\"Failed to read the selected media because the operation failed.\"));\n        };\n        reader.onload = function (_ref4) {\n          var target = _ref4.target;\n          var uri = target.result;\n          resolve({\n            cancelled: false,\n            uri: uri,\n            width: 0,\n            height: 0\n          });\n        };\n        reader.readAsDataURL(targetFile);\n      } else {\n        resolve({\n          cancelled: true\n        });\n      }\n      document.body.removeChild(input);\n    });\n    var event = new MouseEvent('click');\n    input.dispatchEvent(event);\n  });\n}","map":{"version":3,"mappings":"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","names":["Permissions","PermissionStatus","uuidv4","MediaTypeOptions","MediaTypeInput","All","Images","Videos","name","launchImageLibraryAsync","mediaTypes","allowsMultipleSelection","openFileBrowserAsync","launchCameraAsync","capture","getCameraPermissionAsync","getAsync","CAMERA","requestCameraPermissionsAsync","askAsync","getCameraRollPermissionsAsync","permissionGrantedResponse","requestCameraRollPermissionsAsync","status","GRANTED","expires","granted","canAskAgain","mediaTypeFormat","input","document","createElement","style","display","setAttribute","body","appendChild","Promise","resolve","reject","addEventListener","files","targetFile","reader","FileReader","onerror","Error","onload","target","uri","result","cancelled","width","height","readAsDataURL","removeChild","event","MouseEvent","dispatchEvent"],"sourceRoot":"","sources":["../src/ExponentImagePicker.web.ts"],"sourcesContent":["import * as Permissions from 'expo-permissions';\nimport { PermissionResponse, PermissionStatus } from 'unimodules-permissions-interface';\nimport uuidv4 from 'uuid/v4';\n\nimport {\n  ImagePickerResult,\n  MediaTypeOptions,\n  OpenFileBrowserOptions,\n  ImagePickerOptions,\n} from './ImagePicker.types';\n\nconst MediaTypeInput = {\n  [MediaTypeOptions.All]: 'video/mp4,video/quicktime,video/x-m4v,video/*,image/*',\n  [MediaTypeOptions.Images]: 'image/*',\n  [MediaTypeOptions.Videos]: 'video/mp4,video/quicktime,video/x-m4v,video/*',\n};\n\nexport default {\n  get name(): string {\n    return 'ExponentImagePicker';\n  },\n\n  async launchImageLibraryAsync({\n    mediaTypes = MediaTypeOptions.All,\n    allowsMultipleSelection = false,\n  }: ImagePickerOptions): Promise<ImagePickerResult> {\n    return await openFileBrowserAsync({\n      mediaTypes,\n      allowsMultipleSelection,\n    });\n  },\n\n  async launchCameraAsync({\n    mediaTypes = MediaTypeOptions.All,\n    allowsMultipleSelection = false,\n  }: ImagePickerOptions): Promise<ImagePickerResult> {\n    return await openFileBrowserAsync({\n      mediaTypes,\n      allowsMultipleSelection,\n      capture: true,\n    });\n  },\n\n  /*\n   * Delegate to expo-permissions to request camera permissions\n   */\n  async getCameraPermissionAsync() {\n    return Permissions.getAsync(Permissions.CAMERA);\n  },\n  async requestCameraPermissionsAsync() {\n    return Permissions.askAsync(Permissions.CAMERA);\n  },\n\n  /*\n   * Camera roll permissions don't need to be requested on web, so we always\n   * respond with granted.\n   */\n  async getCameraRollPermissionsAsync(): Promise<PermissionResponse> {\n    return permissionGrantedResponse();\n  },\n  async requestCameraRollPermissionsAsync(): Promise<PermissionResponse> {\n    return permissionGrantedResponse();\n  },\n};\n\nfunction permissionGrantedResponse(): PermissionResponse {\n  return {\n    status: PermissionStatus.GRANTED,\n    expires: 'never',\n    granted: true,\n    canAskAgain: true,\n  };\n}\n\nfunction openFileBrowserAsync({\n  mediaTypes,\n  capture = false,\n  allowsMultipleSelection = false,\n}: OpenFileBrowserOptions): Promise<ImagePickerResult> {\n  const mediaTypeFormat = MediaTypeInput[mediaTypes];\n\n  const input = document.createElement('input');\n  input.style.display = 'none';\n  input.setAttribute('type', 'file');\n  input.setAttribute('accept', mediaTypeFormat);\n  input.setAttribute('id', uuidv4());\n  if (allowsMultipleSelection) {\n    input.setAttribute('multiple', 'multiple');\n  }\n  if (capture) {\n    input.setAttribute('capture', 'camera');\n  }\n  document.body.appendChild(input);\n\n  return new Promise((resolve, reject) => {\n    input.addEventListener('change', () => {\n      if (input.files) {\n        const targetFile = input.files[0];\n        const reader = new FileReader();\n        reader.onerror = () => {\n          reject(new Error(`Failed to read the selected media because the operation failed.`));\n        };\n        reader.onload = ({ target }) => {\n          const uri = (target as any).result;\n          resolve({\n            cancelled: false,\n            uri,\n            width: 0,\n            height: 0,\n          });\n        };\n        // Read in the image file as a binary string.\n        reader.readAsDataURL(targetFile);\n      } else {\n        resolve({ cancelled: true });\n      }\n\n      document.body.removeChild(input);\n    });\n\n    const event = new MouseEvent('click');\n    input.dispatchEvent(event);\n  });\n}\n"]},"metadata":{},"sourceType":"module"}